{% extends '__bs_base__.html' %}
{% block title %}日志{% endblock %}
{% block css %}
<style type="text/css">
</style>
{% endblock %}  

    {% block navbar %}
    <li><a href="/"><span class="glyphicon glyphicon-home"></span> 首页</a></li>
    <li class="active"><a href="/bs/blogs"><span class="glyphicon glyphicon-book"></span> 日志</a></li>
    {% if __user__.admin %}
    <li><a href="/bs/manage/blogs"><span class="glyphicon glyphicon-wrench"></span> 管理</a></li>
    {% endif %}
    <li><a href="/about"><span class="glyphicon glyphicon-info-sign"></span> 关于</a></li>
    {% endblock %}

{% block content %}
<div class="container" style="margin-top: 50px">
    <div style="padding: 10px"></div>
    <div class="row">
    <div class="col-md-8">
    <div id="vm">
        <form v-on:submit="submit">
            <div class="alert alert-danger hidden"></div>
            <label>标题</label>
                <input v-model="name" name="name" type="text" placeholder="标题" class="form-control" />
            <label>内容</label>
            <textarea v-model="content" rows="16" name="content" placeholder="内容" class="uk-width-1-1" style="resize:none;"></textarea>

            <button type="submit" class="btn btn-info"><i class="uk-icon-save"></i> 保存</button>
            <a href="/bs/manage/blogs" class="btn btn-danger"><i class="uk-icon-times"></i> 取消</a>

        </form>
    </div>
    </div>
    </div>
</div>
<script>
var
    ID = '{{ id }}',
    action = '{{ action }}';
function initVM(blog) {
    var vm = new Vue({
        el: '#vm',
        data: blog,
        methods: {
            submit: function (event) {
                event.preventDefault();
                var $form = $('#vm').find('form');
                $form.postJSON(action, this.$data, function (err, r) {
                    if (err) {
                        $form.showFormError(err);
                    }
                    else {
                        return location.assign('/blog/' + r.id);
                    }
                });
            }
        }
    });
    $('#vm').show();
}
$(function () {
    if (ID) {
        getJSON('/api/blogs/' + ID, function (err, blog) {
            if (err) {
                return fatal(err);
            }
            $('#loading').hide();
            initVM(blog);
        });
    }
    else {
        $('#loading').hide();
        initVM({
            name: '',
            summary: '',
            content: ''
        });
    }
});
</script>
{% endblock %}